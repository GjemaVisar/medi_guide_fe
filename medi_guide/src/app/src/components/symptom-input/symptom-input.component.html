<div class="symptom-input-container">
  <div class="container-small">
    <!-- Progress Indicator -->
    <div class="progress-container mb-xl">
      <div class="progress-bar">
        <div class="progress-fill" style="width: 33%"></div>
      </div>
      <p class="progress-text">{{ "STEP_INDICATOR" | translate }}</p>
    </div>

    <div class="card">
      <div class="card-header text-center">
        <h2>{{ "SYMPTOMS_TITLE" | translate }}</h2>
        <p>{{ "SYMPTOMS_SUBTITLE" | translate }}</p>
      </div>

      <div class="card-body">
        <!-- Search Input -->
        <div class="search-container mb-lg">
          <div class="form-group">
            <label for="symptom-search" class="form-label sr-only">
              {{ "SEARCH_LABEL" | translate }}
            </label>
            <div class="search-input-container">
              <input
                type="text"
                id="symptom-search"
                class="form-input search-input"
                [(ngModel)]="searchQuery"
                (input)="onSearchInput($event)"
                [placeholder]="'SEARCH_PLACEHOLDER' | translate"
                aria-describedby="search-help"
                autocomplete="off"
              />
              <div class="search-icon">
                <!-- magnifier SVG -->
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <circle
                    cx="9"
                    cy="9"
                    r="7"
                    stroke="currentColor"
                    stroke-width="2"
                    fill="none"
                  />
                  <path
                    d="m16 16 4.35 4.35"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
              </div>
            </div>
            <p id="search-help" class="search-help">
              {{ "SEARCH_HELP" | translate }}
            </p>
          </div>

          <!-- Search Results -->
          <div
            class="search-results"
            *ngIf="searchResults.length > 0 && showResults"
            role="listbox"
            aria-label="Symptom suggestions"
          >
            <button
              type="button"
              class="search-result-item"
              *ngFor="let symptom of searchResults; trackBy: trackBySymptomId"
              (click)="selectSymptom(symptom)"
              role="option"
              [attr.aria-label]="
                'SELECT_SYMPTOM_ARIA'
                  | translate : { symptomName: symptom.commonName }
              "
            >
              <div class="symptom-info">
                <span class="symptom-name">{{ symptom.commonName }}</span>
                <span class="symptom-category">{{ symptom.category }}</span>
              </div>
              <div
                class="severity-indicator"
                [class]="'status-' + symptom.severity"
              >
                {{ symptom.severity }}
              </div>
            </button>
          </div>

          <!-- No Results -->
          <div
            class="no-results"
            *ngIf="searchQuery && searchResults.length === 0 && !isSearching"
          >
            <div class="no-results-content">
              <svg width="48" height="48" viewBox="0 0 48 48">
                <circle
                  cx="24"
                  cy="24"
                  r="22"
                  stroke="#E1E8ED"
                  stroke-width="4"
                />
                <path
                  d="M16 24h16M24 16v16"
                  stroke="#E1E8ED"
                  stroke-width="4"
                  stroke-linecap="round"
                />
              </svg>
              <h4>{{ "NO_RESULTS_TITLE" | translate }}</h4>
              <p>{{ "NO_RESULTS_BODY" | translate }}</p>
            </div>
          </div>

          <!-- Loading -->
          <div class="loading" *ngIf="isSearching">
            <div class="loading-spinner"></div>
            <p>{{ "LOADING_SYMPTOMS" | translate }}</p>
          </div>
        </div>

        <!-- Selected Symptoms -->
        <div class="selected-symptoms" *ngIf="selectedSymptoms.length > 0">
          <h3>{{ "YOUR_SYMPTOMS" | translate }}</h3>
          <div class="symptom-cards">
            <div
              class="symptom-card"
              *ngFor="
                let symptomInput of selectedSymptoms;
                trackBy: trackBySymptomInputId
              "
            >
              <div class="symptom-card-header">
                <h4>{{ symptomInput.symptom.commonName }}</h4>
                <button
                  type="button"
                  class="remove-symptom-btn"
                  (click)="removeSymptom(symptomInput)"
                  [attr.aria-label]="
                    'REMOVE_SYMPTOM_ARIA'
                      | translate
                        : { symptomName: symptomInput.symptom.commonName }
                  "
                >
                  <!-- X icon -->
                  <svg width="16" height="16" viewBox="0 0 16 16">
                    <path
                      d="M12 4L4 12M4 4l8 8"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                </button>
              </div>

              <div class="symptom-details">
                <!-- Severity -->
                <div class="detail-group">
                  <label
                    [for]="'severity-' + symptomInput.symptom.id"
                    class="detail-label"
                  >
                    {{ "SEVERITY_LABEL" | translate }}
                  </label>
                  <select
                    [id]="'severity-' + symptomInput.symptom.id"
                    class="detail-select"
                    [(ngModel)]="symptomInput.severity"
                  >
                    <option value="mild">
                      {{ "SEVERITY_MILD" | translate }}
                    </option>
                    <option value="moderate">
                      {{ "SEVERITY_MODERATE" | translate }}
                    </option>
                    <option value="severe">
                      {{ "SEVERITY_SEVERE" | translate }}
                    </option>
                  </select>
                </div>

                <!-- Duration -->
                <div class="detail-group">
                  <label
                    [for]="'duration-' + symptomInput.symptom.id"
                    class="detail-label"
                  >
                    {{ "DURATION_LABEL" | translate }}
                  </label>
                  <select
                    [id]="'duration-' + symptomInput.symptom.id"
                    class="detail-select"
                    [(ngModel)]="symptomInput.duration"
                  >
                    <option value="less-than-hour">
                      {{ "DURATION_LESS_HOUR" | translate }}
                    </option>
                    <option value="few-hours">
                      {{ "DURATION_FEW_HOURS" | translate }}
                    </option>
                    <option value="1-day">
                      {{ "DURATION_ONE_DAY" | translate }}
                    </option>
                    <option value="few-days">
                      {{ "DURATION_FEW_DAYS" | translate }}
                    </option>
                    <option value="1-week">
                      {{ "DURATION_ONE_WEEK" | translate }}
                    </option>
                    <option value="more-than-week">
                      {{ "DURATION_MORE_WEEK" | translate }}
                    </option>
                  </select>
                </div>

                <!-- Frequency -->
                <div class="detail-group">
                  <label
                    [for]="'frequency-' + symptomInput.symptom.id"
                    class="detail-label"
                  >
                    {{ "FREQUENCY_LABEL" | translate }}
                  </label>
                  <select
                    [id]="'frequency-' + symptomInput.symptom.id"
                    class="detail-select"
                    [(ngModel)]="symptomInput.frequency"
                  >
                    <option value="constant">
                      {{ "FREQUENCY_CONSTANT" | translate }}
                    </option>
                    <option value="frequent">
                      {{ "FREQUENCY_FREQUENT" | translate }}
                    </option>
                    <option value="occasional">
                      {{ "FREQUENCY_OCCASIONAL" | translate }}
                    </option>
                    <option value="rare">
                      {{ "FREQUENCY_RARE" | translate }}
                    </option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="card-footer" *ngIf="selectedSymptoms.length > 0">
        <div class="footer-actions">
          <button type="button" class="btn btn-secondary" (click)="goBack()">
            {{ "BUTTON_BACK" | translate }}
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="continueToQuestions()"
            [disabled]="selectedSymptoms.length === 0"
          >
            <span>{{ "BUTTON_CONTINUE" | translate }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
